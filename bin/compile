#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

# fail fast
# set -e

# debug
# set -x

echo "-------------------------------------------------------------------------"
echo "args: $1 $2"
echo "-------------------------------------------------------------------------"
echo ""

echo "-------------------------------------------------------------------------"
echo "pwd: `pwd`"
echo "-------------------------------------------------------------------------"
echo ""

echo "-------------------------------------------------------------------------"
echo "env"
echo "-------------------------------------------------------------------------"
env
echo ""

echo "-------------------------------------------------------------------------"
echo "ls ."
echo "-------------------------------------------------------------------------"
ls -alR .
echo ""

echo "-------------------------------------------------------------------------"
echo "ls $1"
echo "-------------------------------------------------------------------------"
ls -alR $1
echo ""

echo "-------------------------------------------------------------------------"
echo "ls $2"
echo "-------------------------------------------------------------------------"
ls -alR $2
echo ""

echo "-------------------------------------------------------------------------"
echo "contents of $2/dump/cached.txt (from previous build)"
echo "-------------------------------------------------------------------------"
cat $2/dump/cached.txt
echo ""

echo "-------------------------------------------------------------------------"
echo "contents of $2/dump/cached.txt (recreated)"
echo "-------------------------------------------------------------------------"
mkdir -p $2/dump
date > $2/dump/cached.txt
cat $2/dump/cached.txt
echo ""

echo "-------------------------------------------------------------------------"
echo "ls $BUILDPACK_CACHE (ie, env BUILDPACK_CACHE)"
echo "-------------------------------------------------------------------------"
ls -al $BUILDPACK_CACHE
echo ""

exit 0